#!/usr/bin/env ruby
require_relative '../init'
require_relative '../lib/cryptconverter'

require 'temporal/worker'

Dir[File.expand_path('../workflows/*.rb', __dir__)].each { |f| require f }
Dir[File.expand_path('../activities/*.rb', __dir__)].each { |f| require f }
Dir[File.expand_path('../middleware/*.rb', __dir__)].each { |f| require f }

Temporal.configure do |config|
  config.converter =  Temporal::Client::Converter::Crypt.new(
    converter: Temporal::Configuration::DEFAULT_CONVERTER
  )
end

worker = Temporal::Worker.new

worker.register_workflow(HelloWorldWorkflow)

worker.register_activity(HelloWorldActivity)

worker.add_workflow_task_middleware(LoggingMiddleware, 'EXAMPLE')
worker.add_activity_middleware(LoggingMiddleware, 'EXAMPLE')

worker.start
